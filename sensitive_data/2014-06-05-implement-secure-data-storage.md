---
layout: guide
title: "Implement Secure Data Storage"
description: "Storing data securely on a mobile device requires proper technique. Whenever possible, simply do not store/cache data. This is the most sure way to avoid data compromise on the device."
published: 1
categories:
  - handling-sensitive-data
series:
  name: Handling Sensitive Data
  index: 1
order: 201
--- 

## Details 

Storing data securely on a mobile device requires proper technique. Whenever possible, ***simply do not store/cache data.*** This is the most sure way to avoid data compromise on the device.

## Remediation

 * Do not store sensitive data where possible. Options to reduce the storage of user information include:
   * Transmit and display but do not persist to memory. This requires special attention as well, to ensure that an analog leak does not present itself where screenshots of the data are written to disk.
   * Store only in RAM (clear at application close).
 * **Additional Layered Encryption** – If storing sensitive data on the device is an application requirement, you should add an additional layer of verified, third-party encryption to the data as device encryption is not sufficient. By adding another layer of encryption, you have more control over the implementation and attacks focused on the main OS encryption classes. For example, attacks on iOS data-protection classes (which are now compromised) will not succeed in compromising your application directly. This approach has the drawback of being more complex and, if implemented poorly, can actually reduce security posture. If you are not confident in including a verified third-party crypto library Apple and Android’s common cryptographic libraries provide a number of standard cryptographic functions which, if used properly, can provide a reasonably secure cryptography implementation.
 * Whenever encrypting user data, aim to encrypt it using a randomly generated master key, which is also encrypted using a passphrase supplied by the user whenever data is accessed. This will prevent data from being easily recovered should an attacker extract the master key from the device. Due to the number of vulnerabilities in Apple’s data-protection APIs and keychain and the lack of device encryption on the majority of Android handsets, it is not recommended that the master key or a passphrase be stored on the device at all.
 * **iOS** - The Data Protection APIs built into iOS, combined with a complex passphrase, can provide an additional layer of data protection, but are not as secure as implementing additional, third-party verified cryptography. To leverage this, files must be specifically marked for protection. Any data not specifically encrypted using Apple’s data protection APIs is stored unencrypted.     
 * **Android** - In Android remember that the external storage such as SD Card has no fine grained permissions and that any app by default has read access to the storage and can read all files. Since Android 4.4 apps can store data on the SD Card in a protected way under certain circumstances [see [http://source.android.com/devices/tech/storage/](http://source.android.com/devices/tech/storage/)].   
 * Android and iOS implement standard crypto libraries such as AES that can be used to secure data. Remember that data encrypted with this method is only as secure as the password used to derive the key and key management. Consider the password policy, length and complexity versus user convenience, and how the encryption key is stored in memory. With root access it is possible to dump the memory of a running process and search it for encryption keys.
 * Also note that using the standard cryptographic provider “AES” will often default to the less secure AES-ECB. It is recommended to specify AES-CBC or AES-GCM with a 256bit key and a random IV generated by SecureRandom. It is recommended that the key be derived from a passphrase using the well tested PBKDF2 (Password-Based Key Derivation Function).
 
## References

 * Android/iOS Full Database Encryption - [http://sqlcipher.net/](http://sqlcipher.net/)
 * Android Storage Options - [http://developer.android.com/guide/topics/data/data-storage.html](http://developer.android.com/guide/topics/data/data-storage.html)

## CWE/OWASP 

 * [M2 - Insecure Data Storage](https://www.owasp.org/index.php/Mobile_Top_10_2014-M2)
 * [CWE 312](http://cwe.mitre.org/data/definitions/312.html), [313](http://cwe.mitre.org/data/definitions/313.html), [522](http://cwe.mitre.org/data/definitions/313.html), [215](http://cwe.mitre.org/data/definitions/215.html)